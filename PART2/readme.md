# VSDBabySoC: RTL Synthesis and Simulation Project

## ğŸ¯ Objective
The goal of this project is to **build a solid understanding of SoC fundamentals** and practice functional modeling of the **BabySoC** using simulation tools.  

The **VSDBabySoC** is a simple System-on-Chip (SoC) design that incorporates:  

- **RISC-V processor (`rvmyth`)**  
- **PLL (Phase-Locked Loop) module (`pll`)**  
- **DAC (Digital-to-Analog Converter) module (`dac`)**  

This project demonstrates **integration of these IP cores** and aims to **simulate and verify the design behavior** using **pre-synthesis** and **post-synthesis simulations**.

---

## ğŸ› ï¸ Tools Used

1. **Yosys â€“ RTL Synthesis Tool**  
   - Converts RTL code into gate-level representations.

2. **Icarus Verilog & GTKWave**  
   - **Icarus Verilog:** For compilation and simulation.  
   - **GTKWave:** For viewing waveform files.

---

## ğŸ“‚ Project Structure

```txt
VSDBabySoC/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ include/           # Header files (*.vh) with macros & parameters
â”‚   â”œâ”€â”€ module/            # All design modules (Verilog + TL-Verilog)
â”‚   â”‚   â”œâ”€â”€ vsdbabysoc.v   # Top-level SoC integration
â”‚   â”‚   â”œâ”€â”€ rvmyth.v       # RISC-V CPU core
â”‚   â”‚   â”œâ”€â”€ avsdpll.v      # Phase-Locked Loop module
â”‚   â”‚   â”œâ”€â”€ avsddac.v      # Digital-to-Analog Converter
â”‚   â”‚   â””â”€â”€ testbench.v    # Simulation testbench
â”œâ”€â”€ output/                # Simulation results & compiled files
â”‚   â”œâ”€â”€ pre_synth_sim/     # Pre-synthesis simulation outputs
â”‚   â””â”€â”€ post_synth_sim/    # Post-synthesis simulation outputs
â””â”€â”€ images/                # Documentation & waveform screenshots
```
---
ğŸ”§ TL-Verilog to Verilog Conversion

The RVMYTH CPU core is written in TL-Verilog and needs conversion to Verilog for simulation:
```bash
# Install required tools
sudo apt update
sudo apt install python3-venv python3-pip

# Create and activate virtual environment
python3 -m venv sp_env
source sp_env/bin/activate

# Install SandPiper-SaaS for TLV conversion
pip install pyyaml click sandpiper-saas

# Convert all TL-Verilog files to Verilog
sandpiper-saas -i ./src/module/*.tlv -o rvmyth.v --bestsv --noline -p verilog --outdir ./src/module/
```
âœ… After conversion, rvmyth.v will be available alongside other Verilog modules.

ğŸ§ª Simulation Flow
ğŸ”¹ Pre-Synthesis Simulation
```bash
# Create output directory
mkdir -p output/pre_synth_sim

# Compile design with pre-synthesis flag
iverilog -o output/pre_synth_sim/pre_synth_sim.out \
  -DPRE_SYNTH_SIM \
  -I src/include -I src/module \
  src/module/testbench.v

# Run simulation
cd output/pre_synth_sim
./pre_synth_sim.out
```
ğŸ“Š View Waveforms in GTKWave
```bash
gtkwave pre_synth_sim.vcd
```
---
### ğŸ“ˆ Simulation Results & Waveforms

#### ğŸ” Key Signals to Observe

| Signal                  | Description                                      |
|-------------------------|--------------------------------------------------|
| `CLK`                   | Clock signal generated by PLL                    |
| `reset`                 | System reset signal                              |
| `OUT`                   | Analog output from DAC (digital representation in simulation) |
| `RV_TO_DAC[9:0]`        | 10-bit data bus from RISC-V core to DAC input   |
| `VCO_IN, ENb_CP, ENb_VCO` | PLL control signals                            |
| `VREFH`                 | DAC reference voltage input                      |

ğŸ§© 1ï¸âƒ£ Reset Operation
![pre_synthesis](./images/pre_synth_baby_soc.png)
### ğŸ§© Key Observations

- `OUT = 0.132` â†’ Analog voltage output from DAC  
- `D[9:0] = 088` â†’ Digital input to DAC from RISC-V core  
- `EN = 1` â†’ DAC is enabled  
- `VREFH = 1`, `VREFL = 0` â†’ DAC reference voltages  

**Interpretation:**  
- The RISC-V core is successfully sending digital data to the DAC.  
- DAC converts digital input into analog voltage correctly.  
- Demonstrates proper integration of CPU, PLL, and DAC in pre-synthesis.
---
### â±ï¸ 2ï¸âƒ£ Clocking Behavior

**CLK = 0**
![when clock is at 0 ](./images/when_clk_0.png)
- System is in low clock phase; components are momentarily static.  
- `RV_TO_DAC = 387` â†’ Stable digital value.  
- DAC outputs `0.88V` analog voltage.  
- PLL and CPU operating normally.  

**CLK = 1**
![when clock is at 1 ](./images/when_clk_1.png)
- Clock rising edge triggers data sampling and DAC update.  
- Digital â†’ Analog conversion works in sync with clock.  
---

### ğŸ”„ OUT Voltage Variation
![when output is at 0 ](./images/when_out_0.png)

| OUT | CLK | Digital Input | DAC Output | Reset | Timing     |
|-----|-----|---------------|------------|-------|-----------|
| 0   | 1   | 0BE (190)     | 0.18V      | 0     | 18704 ns  |
| 1   | 0   | 387 (903)     | 0.88V      | 0     | 22891 ns  |

### ğŸ” Observations

- System works during both high and low clock phases.  
- DAC maintains linear digital-to-analog conversion.  
- Timing shows continuous operation over microseconds.  
- `Reset = 0` confirms stable operation.
---
### ğŸ” 3ï¸âƒ£ Dataflow Between Modules 
![Dataflow ](./images/step_babysoc_pre.png)

- Digital input from CPU: `D[9:0] = 12C`  
- Passed to DAC: `Dext[10:0] = 12C`  
- DAC converts to analog output: `OUT â‰ˆ 0.29V`
Conclusion:
Digital data flows correctly from CPU â†’ DAC â†’ Analog output, forming a smooth waveform. This confirms correct module integration and data transfer.
