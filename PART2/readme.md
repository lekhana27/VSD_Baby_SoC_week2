VSDBabySoC: RTL Synthesis and Simulation Project
🎯 Objective
To build a solid understanding of SoC fundamentals and practice functional modelling of the BabySoC using simulation tools. The VSDBabySoC is a simple SoC (System-on-Chip) design incorporating a RISC-V processor (rvmyth), a PLL (Phase-Locked Loop) module (pll), and a DAC (Digital-to-Analog Converter) module (dac). This project demonstrates integration of these IP cores and aims to simulate and verify the design behavior using pre-synthesis and post-synthesis simulations.
🛠️ Tools Used
1. Yosys – RTL Synthesis Tool
Purpose: Converts RTL code into gate-level representations.
2. Icarus Verilog & GTKWave
Icarus Verilog: For compilation and simulation.
GTKWave: For viewing waveform files.

📂 Project Structure
text
VSDBabySoC/
├── src/
│   ├── include/           # Header files (*.vh) with macros & parameters
│   ├── module/            # All design modules (Verilog + TL-Verilog)
│   │   ├── vsdbabysoc.v   # Top-level SoC integration
│   │   ├── rvmyth.v       # RISC-V CPU core
│   │   ├── avsdpll.v      # Phase-Locked Loop module
│   │   ├── avsddac.v      # Digital-to-Analog Converter
│   │   └── testbench.v    # Simulation testbench
├── output/                # Simulation results & compiled files
│   ├── pre_synth_sim/     # Pre-synthesis simulation outputs
│   └── post_synth_sim/    # Post-synthesis simulation outputs
└── images/                # Documentation & waveform screenshots
🔧 TL-Verilog to Verilog Conversion
The RVMYTH CPU core is written in TL-Verilog and needs conversion to Verilog for simulation:

bash
# Install required tools
sudo apt update
sudo apt install python3-venv python3-pip

# Create and activate virtual environment
python3 -m venv sp_env
source sp_env/bin/activate

# Install SandPiper-SaaS for TLV conversion
pip install pyyaml click sandpiper-saas

# Convert all TL-Verilog files to Verilog
sandpiper-saas -i ./src/module/*.tlv -o rvmyth.v --bestsv --noline -p verilog --outdir ./src/module/
✅ After conversion, rvmyth.v will be available alongside other Verilog modules.

🧪 Simulation Flow
🔹 Pre-Synthesis Simulation
bash
# Create output directory
mkdir -p output/pre_synth_sim

# Compile design with pre-synthesis flag
iverilog -o output/pre_synth_sim/pre_synth_sim.out \
  -DPRE_SYNTH_SIM \
  -I src/include -I src/module \
  src/module/testbench.v

# Run simulation
cd output/pre_synth_sim
./pre_synth_sim.out
📊 View Waveforms in GTKWave:
bash
gtkwave pre_synth_sim.vcd
📈 Simulation Results & Waveforms
🔍 Key Signals to Observe:
⏱️ CLK → Clock signal generated by PLL

🔄 reset → System reset signal

🎚️ OUT → Analog output from DAC (digital representation in simulation)

🔢 RV_TO_DAC[9:0] → 10-bit data bus from RISC-V core to DAC input

⚡ VCO_IN, ENb_CP, ENb_VCO → PLL control signals

🔋 VREFH → DAC reference voltage input

RESULTS

🧩 1️⃣ Reset Operation
![pre_synthesis](./images/pre_synth_baby_soc.png)
This image shows the pre-synthesis simulation results of the VSDBabySoC in GTKWave.

🔍 Key Observations:
OUT signal = 0.132 (analog voltage output from DAC)

D[9:0] = 088 (digital input to DAC from RISC-V core)

EN = 1 (DAC is enabled)

VREFH = 1 (DAC reference voltage high)

VREFL = 0 (DAC reference voltage low)

📊 What This Shows:
The simulation is working correctly! The RISC-V core is sending digital data (088 in hexadecimal) to the DAC, which converts it to an analog voltage of 0.132V. This demonstrates successful integration of the CPU, PLL, and DAC modules in the pre-synthesis design phase.

The waveform confirms that the BabySoC components are properly communicating and the digital-to-analog conversion is functioning as expected.

![Reset](./images/when_clk_0.png)
Reset = 0 → System running normally

CPU active: Processing data, outputting 387 to DAC

DAC converting: Digital 387 → Analog 0.88V

PLL clocking: Regular clock pulses

All modules: Operating without reset interference

System state: Fully functional, executing instructions normally

⏱️ 2️⃣ Clocking
![when clock is at 0 ](./images/when_clk_0.png)
CLK = 0 → Clock signal is currently at logic low state in its cycle

🔄 Timing Behavior:
Between active edges: The system is in a brief holding period between clock cycles

Synchronous pause: All digital components are momentarily static, waiting for the next rising edge

Data stability: The RISC-V core maintains its output RV_TO_DAC = 387 (hex) consistently

Analog consistency: The DAC continues outputting a stable analog voltage of 0.88V based on the held digital input

⚡ System Status:
PLL operational: The phase-locked loop is actively maintaining clock timing

Reset inactive: With reset = 0, no forced initialization is occurring

Normal operation: This low clock state is part of regular digital system behavior

Ready for transition: The system is prepared for the next clock rising edge to trigger new operations

System state: Standard digital timing behavior with all modules functioning properly between clock transitions

![when clock is at 1 ](./images/when_clk_1.png)

When the CLK = 1, the core outputs the digital value D[9:0] = 387, which is transferred to the DAC input Dext[10:0] = 387. The DAC converts this digital data into the corresponding analog voltage OUT ≈ 0.88 V.
The waveform shows that changes in CLK trigger data sampling and update of OUT, indicating proper synchronization between the core and DAC. The analog OUT waveform smoothly follows the digital input transitions in sync with the clock, confirming correct clock-driven data transfer and DAC operation.

![when output is at 0  ](./images/when_out_0.png)
(OUT = 0):
CLK = 1 (Active high state)

Digital Input: D[9:0] = 0BE = 190 decimal

DAC Output: 0.18V (low voltage)

Reset = 0 (System operating normally)

Timing: ~18704 ns

(OUT = 1):
CLK = 0 (Low state between cycles)

Digital Input: D[9:0] = 387 = 903 decimal

DAC Output: 0.88V (higher voltage)

Reset = 0 (System operating normally)

Timing: ~22891 ns

🔍 Multi-Factor Analysis:
Clock State Impact:

Different clock states show the system works in both high and low phases

Data remains stable regardless of clock level

Digital-to-Analog Relationship:

0BE (190) → 0.18V = 0.095% conversion ratio

387 (903) → 0.88V = 0.097% conversion ratio

Nearly linear relationship maintained

Timing Progression:

~4.2μs difference between samples

Shows continuous operation over time

Reset Consistency:

Both cases have reset = 0 confirming stable, uninterrupted operation

System Health:

PLL maintaining proper clock

CPU generating varying data patterns

DAC accurately converting digital to analog

All modules synchronized and functional
🔁 3️⃣ Dataflow Between Modules

![Dataflow ](./images/step_babysoc_pre.png)
The waveform shows proper data transfer through the module hierarchy — core → dac → OUT.
The digital input bus D[9:0] = 12C from the core is passed to the DAC as Dext[10:0] = 12C, indicating correct propagation of digital data. The DAC then converts this digital value into the corresponding analog output OUT ≈ 0.29 V.
As the simulation progresses, variations in the digital values of D and Dext produce proportional changes in the OUT waveform, forming a smooth analog signal. This confirms that the DAC is correctly converting digital inputs from the core into an analog voltage output.
