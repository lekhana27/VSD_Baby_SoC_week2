# VSDBabySoC: RTL Synthesis and Simulation Project

## 🎯 Objective
The goal of this project is to **build a solid understanding of SoC fundamentals** and practice functional modeling of the **BabySoC** using simulation tools.  

The **VSDBabySoC** is a simple System-on-Chip (SoC) design that incorporates:  

- **RISC-V processor (`rvmyth`)**  
- **PLL (Phase-Locked Loop) module (`pll`)**  
- **DAC (Digital-to-Analog Converter) module (`dac`)**  

This project demonstrates **integration of these IP cores** and aims to **simulate and verify the design behavior** using **pre-synthesis** and **post-synthesis simulations**.

---

## 🛠️ Tools Used

1. **Yosys – RTL Synthesis Tool**  
   - Converts RTL code into gate-level representations.

2. **Icarus Verilog & GTKWave**  
   - **Icarus Verilog:** For compilation and simulation.  
   - **GTKWave:** For viewing waveform files.

---

## 📂 Project Structure

```txt
VSDBabySoC/
├── src/
│   ├── include/           # Header files (*.vh) with macros & parameters
│   ├── module/            # All design modules (Verilog + TL-Verilog)
│   │   ├── vsdbabysoc.v   # Top-level SoC integration
│   │   ├── rvmyth.v       # RISC-V CPU core
│   │   ├── avsdpll.v      # Phase-Locked Loop module
│   │   ├── avsddac.v      # Digital-to-Analog Converter
│   │   └── testbench.v    # Simulation testbench
├── output/                # Simulation results & compiled files
│   ├── pre_synth_sim/     # Pre-synthesis simulation outputs
│   └── post_synth_sim/    # Post-synthesis simulation outputs
└── images/                # Documentation & waveform screenshots
```
---
🔧 TL-Verilog to Verilog Conversion

The RVMYTH CPU core is written in TL-Verilog and needs conversion to Verilog for simulation:
```bash
# Install required tools
sudo apt update
sudo apt install python3-venv python3-pip

# Create and activate virtual environment
python3 -m venv sp_env
source sp_env/bin/activate

# Install SandPiper-SaaS for TLV conversion
pip install pyyaml click sandpiper-saas

# Convert all TL-Verilog files to Verilog
sandpiper-saas -i ./src/module/*.tlv -o rvmyth.v --bestsv --noline -p verilog --outdir ./src/module/
```
✅ After conversion, rvmyth.v will be available alongside other Verilog modules.

🧪 Simulation Flow
🔹 Pre-Synthesis Simulation
```bash
# Create output directory
mkdir -p output/pre_synth_sim

# Compile design with pre-synthesis flag
iverilog -o output/pre_synth_sim/pre_synth_sim.out \
  -DPRE_SYNTH_SIM \
  -I src/include -I src/module \
  src/module/testbench.v

# Run simulation
cd output/pre_synth_sim
./pre_synth_sim.out
```
📊 View Waveforms in GTKWave
```bash
gtkwave pre_synth_sim.vcd
```
---
### 📈 Simulation Results & Waveforms

#### 🔍 Key Signals to Observe

| Signal                  | Description                                      |
|-------------------------|--------------------------------------------------|
| `CLK`                   | Clock signal generated by PLL                    |
| `reset`                 | System reset signal                              |
| `OUT`                   | Analog output from DAC (digital representation in simulation) |
| `RV_TO_DAC[9:0]`        | 10-bit data bus from RISC-V core to DAC input   |
| `VCO_IN, ENb_CP, ENb_VCO` | PLL control signals                            |
| `VREFH`                 | DAC reference voltage input                      |

🧩 1️⃣ Reset Operation
![pre_synthesis](./images/pre_synth_baby_soc.png)
### 🧩 Key Observations

- `OUT = 0.132` → Analog voltage output from DAC  
- `D[9:0] = 088` → Digital input to DAC from RISC-V core  
- `EN = 1` → DAC is enabled  
- `VREFH = 1`, `VREFL = 0` → DAC reference voltages  

**Interpretation:**  
- The RISC-V core is successfully sending digital data to the DAC.  
- DAC converts digital input into analog voltage correctly.  
- Demonstrates proper integration of CPU, PLL, and DAC in pre-synthesis.
---
### ⏱️ 2️⃣ Clocking Behavior

**CLK = 0**
![when clock is at 0 ](./images/when_clk_0.png)
- System is in low clock phase; components are momentarily static.  
- `RV_TO_DAC = 387` → Stable digital value.  
- DAC outputs `0.88V` analog voltage.  
- PLL and CPU operating normally.  

**CLK = 1**
![when clock is at 1 ](./images/when_clk_1.png)
- Clock rising edge triggers data sampling and DAC update.  
- Digital → Analog conversion works in sync with clock.  
---

### 🔄 OUT Voltage Variation
![when output is at 0 ](./images/when_out_0.png)

| OUT | CLK | Digital Input | DAC Output | Reset | Timing     |
|-----|-----|---------------|------------|-------|-----------|
| 0   | 1   | 0BE (190)     | 0.18V      | 0     | 18704 ns  |
| 1   | 0   | 387 (903)     | 0.88V      | 0     | 22891 ns  |

### 🔍 Observations

- System works during both high and low clock phases.  
- DAC maintains linear digital-to-analog conversion.  
- Timing shows continuous operation over microseconds.  
- `Reset = 0` confirms stable operation.
---
### 🔁 3️⃣ Dataflow Between Modules 
![Dataflow ](./images/step_babysoc_pre.png)

- Digital input from CPU: `D[9:0] = 12C`  
- Passed to DAC: `Dext[10:0] = 12C`  
- DAC converts to analog output: `OUT ≈ 0.29V`
Conclusion:
Digital data flows correctly from CPU → DAC → Analog output, forming a smooth waveform. This confirms correct module integration and data transfer.
---
## 🧪 Post-Synthesis Simulation

Post-synthesis simulation checks the **functionality and timing** of the synthesized design using the **gate-level netlist**. Unlike pre-synthesis simulation, which verifies RTL logic only, post-synthesis ensures correct behavior under real-world conditions and reveals issues like glitches, race conditions, or unintended latches.

### 🔹 Why Pre- vs Post-Synthesis?

- **Pre-Synthesis Simulation:**  
  - Verifies logical functionality of RTL  
  - Detects design errors early  
  - Fast, abstract simulation  

- **Post-Synthesis Simulation:**  
  - Checks functionality and timing at gate level  
  - Accounts for gate delays  
  - Identifies synthesis-induced issues  

### 🔹 Comparison

| Aspect          | Pre-Synthesis        | Post-Synthesis          |
|-----------------|-------------------|------------------------|
| Focus           | RTL logic          | Functionality + Timing |
| Design Level    | RTL / behavioral   | Gate-level netlist     |
| Purpose         | Catch logical errors | Catch timing/synthesis issues |
| Speed           | Faster             | Slower                 |
| Accuracy        | Abstract           | Realistic (gate delays)|
---
## 🧪 Simulation
![post_synthesis ](./images/post_synth.jpg)

## 📈 Signal Behavior Analysis

### Clock Signal (CLK)
- Regular toggling between 0 and 1  
- Consistent frequency maintained throughout  
- Indicates PLL is working properly, generating a stable clock  

### Digital Data (RV_TO_DAC / D[9:0])
- Changing values over time: `0BE → 387 → 0AB → 0E7`  
- Non-linear pattern indicates CPU is executing different instructions  
- Values represent varying output from RISC-V core  

### Analog Output (OUT)
- Voltage changes correspond to digital input changes  
- `0.18V → 0.88V → varying` over time  
- Shows DAC conversion is dynamic and working correctly  

### Reset Signal
- Stable at `0` throughout observations  
- Confirms continuous operation without interruptions  

### 🔄 Key Pattern Observations

- **Time Progression:** Signals captured at different time points (18.7μs, 22.9μs, etc.) show continuous system operation  
- **Signal Relationships:** CLK edges correlate with data stability periods; OUT voltage directly follows D[9:0] changes  
- **System Health:** No glitches or anomalies; clean transitions and stable voltage levels maintained  

**Conclusion:**  
The waveforms show a properly functioning digital system with coordinated signal changes and accurate analog conversion.
✅ The simulation results are consistent, indicating that the design’s functionality is maintained after synthesis.  

This confirms that the synthesized netlist behaves equivalently to the original RTL design.

